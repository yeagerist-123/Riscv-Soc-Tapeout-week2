## 📝 Overview
The **VSDBabySoC** is a simple SoC (System-on-Chip) design, combining a RISC-V processor (`rvmyth`) 🖥️, a PLL (Phase-Locked Loop) module (`pll`) ⏰, and a DAC (Digital-to-Analog Converter) module (`dac`) 🎛️. This demo project showcases how to integrate these IP blocks and guides you through simulating and verifying the system with both pre-synthesis and post-synthesis flows! 🚦

## 🗂️ Project Structure
- `src/include/` 📁 – Header files (`*.vh`) with macros and parameters.
- `src/module/` 📁 – Verilog files for each module in the SoC.
- `output/` 📁 – All compiled outputs and simulation files.
- `compiled_tlv/` 📁 – Holds intermediate compiled files if needed.

## 🛠️ Requirements
Make sure you have **Icarus Verilog** 🧪 for compilation and **GTKWave** 🌊 for waveform viewing. This project is intended for Unix-like environments (macOS/Linux) 🐧🍎.

## 🚀 Step-by-Step Guide

### 1️⃣ Setup and Prepare Project Directory
Clone or organize your directory like this:
```txt
VSDBabySoC/
├── src/
│   ├── include/
│   │   ├── sandpiper.vh
│   │   └── other header files...
│   ├── module/
│   │   ├── vsdbabysoc.v      # Top-level module integrating all components
│   │   ├── rvmyth.v          # RISC-V core module
│   │   ├── avsdpll.v         # PLL module
│   │   ├── avsddac.v         # DAC module
│   │   └── testbench.v       # Testbench for simulation
└── output/
└── compiled_tlv/         # Holds compiled intermediate files if needed
```
### 🛠️ Cloning the Project

To begin, clone the VSDBabySoC repository using the following command:

```bash
cd ~/VLSI

git clone https://github.com/manili/VSDBabySoC.git

cd ~/VLSI/VSDBabySoC/

spatha@spatha-VirtualBox:~/VLSI$ ls VSDBabySoC/
images  LICENSE  Makefile  README.md  src

spatha@spatha-VirtualBox:~/VLSI$ ls VSDBabySoC/src/module/
avsddac.v  avsdpll.v  clk_gate.v  pseudo_rand_gen.sv  pseudo_rand.sv  rvmyth_gen.v  rvmyth.tlv  rvmyth.v  testbench.rvmyth.post-routing.v  testbench.v  vsdbabysoc.v
```
### TLV to Verilog Conversion for RVMYTH

Initially, you will see only the `rvmyth.tlv` file inside `src/module/`, since the RVMYTH core is written in TL-Verilog.

To convert it into a `.v` file for simulation, follow the steps below:

<strong>🔧 TLV to Verilog Conversion Steps</strong>

```bash
# Step 1: Install python3-venv (if not already installed)
sudo apt update
sudo apt install python3-venv python3-pip

# Step 2: Create and activate a virtual environment
cd ~/VLSI/VSDBabySoC/
python3 -m venv sp_env
source sp_env/bin/activate

# Step 3: Install SandPiper-SaaS inside the virtual environment
pip install pyyaml click sandpiper-saas

# Step 4: Convert rvmyth.tlv to Verilog
sandpiper-saas -i ./src/module/*.tlv -o rvmyth.v --bestsv --noline -p verilog --outdir ./src/module/
```

✅ After running the above command, rvmyth.v will be generated in the src/module/ directory.

You can confirm this by listing the files:

```bash
spatha@spatha-VirtualBox:~$ cd VLSI/VSDBabySoC/
spatha@spatha-VirtualBox:~/VLSI/VSDBabySoC$ ls src/module/
avsddac.v  avsdpll.v  clk_gate.v  pseudo_rand_gen.sv  pseudo_rand.sv  rvmyth_gen.v  rvmyth.tlv  rvmyth.v  testbench.rvmyth.post-routing.v  testbench.v  vsdbabysoc.v
```


### 🧩 Module Descriptions

#### 2.1 vsdbabysoc.v (Top-Level SoC Module) 🏆
This is the top-level module that integrates the rvmyth, pll, and dac modules.  


- **Inputs:**
  - reset 🔄: Resets the core processor.
  - VCO_IN, ENb_CP, ENb_VCO, REF: PLL control signals ⚡
  - VREFH: DAC reference voltage 🔋
- **Outputs:**
  - OUT: Analog output from DAC 📈
- **Connections:**
  - RV_TO_DAC: 10-bit bus that connects the RISC-V core output to the DAC input 🔗
  - CLK: Clock signal generated by PLL ⏰

#### 2.2 rvmyth.v (RISC-V Core) 🖥️
The rvmyth module is a simple RISC-V based processor. It outputs a 10-bit digital signal (OUT) to be converted by the DAC.  


- **Inputs:**
  - CLK: Clock signal generated by the PLL ⏰
  - reset: Initializes or resets the processor 🔄
- **Outputs:**
  - OUT: A 10-bit digital signal representing processed data to be sent to the DAC 🟦
 
  - ## Steps to follow

1. Install `iverilog` and `gtkwave`
2. Simulate rvmyth using the following steps:

     1. `git clone https://github.com/kunalg123/rvmyth/`
     2. `cd rvmyth`
     3. `iverilog mythcore_test.v tb_mythcore_test.v`
     4. `./a.out`
     5. `gtkwave tb_mythcore_test.vcd`
  
 <img width="1920" height="922" alt="rvmythcore wave" src="https://github.com/user-attachments/assets/0dac3357-3586-4dbc-b1ee-6f48e0b20460" />



 *10-bit digital codes observed at the output of rvmyth.*

#### 2.3 avsdpll.v (PLL Module) ⏰
The pll module is a phase-locked loop that generates a stable clock (CLK) for the RISC-V core.  


- **Inputs:**
  - VCO_IN, ENb_CP, ENb_VCO, REF: Control and reference signals for PLL operation ⚡
- **Output:**
  - CLK: A stable clock signal for synchronizing the core and other modules 🕒

#### 2.4 avsddac.v (DAC Module) 🎛️
The dac module converts the 10-bit digital signal from the rvmyth core to an analog output.  


- **Inputs:**
  - D: A 10-bit digital input from the processor 🔢
  - VREFH: Reference voltage for the DAC 🔋
- **Output:**
  - OUT: Analog output signal 📈

### 🧪 Testbench
The `testbench.v` file is a test module to verify the functionality of vsdbabysoc. It includes signal initialization, clock generation, and waveform dumping for both pre-synthesis and post-synthesis simulations.

**Waveform Output:**
- `pre_synth_sim.vcd` or `post_synth_sim.vcd` files generated based on simulation conditions.

---
### Simulation Steps

#### <ins>Pre-Synthesis Simulation</ins>

Run the following command to perform a pre-synthesis simulation:

```bash
cd ~/VLSI/VSDBabySoC/

mkdir -p output/pre_synth_sim

iverilog -o ~/VLSI/VSDBabySoC/output/pre_synth_sim/pre_synth_sim.out -DPRE_SYNTH_SIM -I ~/VLSI/VSDBabySoC/src/include -I ~/VLSI/VSDBabySoC/src/module ~/VLSI/VSDBabySoC/src/module/testbench.v
```

Then run:
```bash
cd output/pre_synth_sim

./pre_synth_sim.out
```

Explanation:

- DPRE_SYNTH_SIM: Defines the PRE_SYNTH_SIM macro for conditional compilation in the testbench.
- The resulting pre_synth_sim.vcd file can be viewed in GTKWave.

#### Viewing Waveform in GTKWave

After running the simulation, open the VCD file in GTKWave: 

```bash

cd ~/VLSI/VSDBabySoC/

gtkwave output/pre_synth_sim/pre_synth_sim.vcd

```
Drag and drop the CLK, reset, OUT (DAC), and RV TO DAC [9:0] signals to their respective locations in the simulation tool

 ![Alt Text](Images/today4.jpg)

In this picture we can see the following signals:

**CLK**: This is the input CLK signal of the RVMYTH core. This signal comes from the PLL, originally.

**reset**: This is the input reset signal of the RVMYTH core. This signal comes from an external source, originally.

**OUT**: This is the output OUT signal of the VSDBabySoC module. This signal comes from the DAC (due to simulation restrictions it behaves like a digital signal which is incorrect), originally.

**RV_TO_DAC[9:0]**: This is the 10-bit output [9:0] OUT port of the RVMYTH core. This port comes from the RVMYTH register #17, originally.

**OUT**: This is a real datatype wire which can simulate analog values. It is the output wire real OUT signal of the DAC module. This signal comes from the DAC, originally. 

This can be viewed by changing the Data Format of the signal to Analog → Step

#### Viewing DAC output in analog mode

Drag and drop the CLK, reset, OUT (DAC) (as analog step), and RV TO DAC [9:0] signals to their respective locations in the simulation tool 


### 👀 Viewing Waveform in GTKWave
After running the simulation, open the VCD file in GTKWave:
```
gtkwave output/pre_synth_sim/pre_synth_sim.vcd
```
<img width="1920" height="922" alt="week-2 gtk" src="https://github.com/user-attachments/assets/7291870e-3a80-48d9-a3a3-c7b81d415e14" />
In this picture we can see the following signals:

**CLK**: This is the input CLK signal of the RVMYTH core. This signal comes from the PLL, originally.

**reset**: This is the input reset signal of the RVMYTH core. This signal comes from an external source, originally.

**OUT**: This is the output OUT signal of the VSDBabySoC module. This signal comes from the DAC (due to simulation restrictions it behaves like a digital signal which is incorrect), originally.

**RV_TO_DAC[9:0]**: This is the 10-bit output [9:0] OUT port of the RVMYTH core. This port comes from the RVMYTH register #17, originally.

**OUT**: This is a real datatype wire which can simulate analog values. It is the output wire real OUT signal of the DAC module. This signal comes from the DAC, originally. 

This can be viewed by changing the Data Format of the signal to Analog → Step

#### Viewing DAC output in analog mode

Drag and drop the CLK, reset, OUT (DAC) (as analog step), and RV TO DAC [9:0] signals to their respective locations in the simulation tool 


### 🏗️ Post-Synthesis Simulation
To run a post-synthesis simulation, use:
```tcl
iverilog -o output/post_synth_sim/post_synth_sim.out -DPOST_SYNTH_SIM \
    -I src/include -I src/module \
    src/module/testbench.v output/synthesized/vsdbabysoc.synth.v
cd output/post_synth_sim
./post_synth_sim.out
```

---

## 🦺 Troubleshooting Tips

- **Module Redefinition ⚠️:** If you encounter redefinition errors, ensure modules are included only once, either in the testbench or in the command line.
- **Path Issues 🛤️:** Verify paths specified with `-I` are correct. Use full/absolute paths if relative paths cause errors.
- **Simulation Output 📄:** If output files aren’t generated, check your simulation and compilation logs for errors.
- **GTKWave Display 🖼️:** If signals aren’t visible, ensure the VCD dump is correctly configured in the testbench.

---

Enjoy building and simulating your BabySoC! 🎉🛠️
